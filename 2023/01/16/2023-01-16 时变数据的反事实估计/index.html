<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <link rel="alternate icon" type="image/png" href="/img/favicon.png">
    <title>Booo | Take me to the TARDIS</title>
    
<link rel="stylesheet" href="/css/reset.css">

    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/css/markdown.css">

    
<link rel="stylesheet" href="/css/fonts.css">

<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Booo" type="application/atom+xml">
</head>
    <body>
        <div class="paper">
            <div class="paper-main">
                
                    <div class="post-header">
    <a class="logo" href="/">Booo</a>
    <a class="go-home" href="/">
        <svg width="8" height="14" viewBox="0 0 8 14">
            <path d="M7 1L1 7l6 6" stroke="#000" stroke-width="2" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </a>
</div>
                
                <div class="post-main">

    
    
        <div class="post-main-title">
            时变数据的反事实估计
        </div>
        <div class="post-meta">
            2023-01-16
        </div>
        <div class="post-md">
            <p>最近两个月在反复在修改实验代码，proposal，最终idea和实验都有些进展，于是记录一下，很多文字描述没有补充，等论文和实验成熟再好好写。</p>
<h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><h2 id="术语"><a href="#术语" class="headerlink" title="术语"></a>术语</h2><h3 id="结局事件-Event"><a href="#结局事件-Event" class="headerlink" title="结局事件  Event"></a>结局事件  Event</h3><p>例如死亡，特定疾病发生， 汽车产品break down…</p>
<h3 id="生存时间（survival-time-failure-time）"><a href="#生存时间（survival-time-failure-time）" class="headerlink" title="生存时间（survival time, failure time）"></a>生存时间（survival time, failure time）</h3><p>终点事件与起始事件之间的时间间隔。<br><img src="https://i.328888.xyz/2023/01/23/OPlEk.png" alt="1"></p>
<h3 id="截尾-x2F-删失-Censor"><a href="#截尾-x2F-删失-Censor" class="headerlink" title="截尾&#x2F;删失 Censor"></a>截尾&#x2F;删失 Censor</h3><p>研究者只能观察调查窗口的两个时间节点之间的相关信息，造成了观察对象在时间窗口外的信息缺失</p>
<h3 id="Survival-function"><a href="#Survival-function" class="headerlink" title="Survival function"></a>Survival function</h3><p>与生存分析相关的一组统计方法的目标是根据生存数据估计生存函数。生存函数S(t)定义了样本在时间t之外存活的概率，或者等价地，持续时间至少为 t<br><img src="https://i.328888.xyz/2023/01/23/OPHWp.png" alt="1"><br><img src="https://i.328888.xyz/2023/01/23/OPOpU.png" alt="2"></p>
<h3 id="Hazard-function"><a href="#Hazard-function" class="headerlink" title="Hazard function"></a>Hazard function</h3><p>计算时间T的风险概率。风险函数模拟了哪些时期发生事件的可能性最高或最低。与生存函数相比，危险函数不必从 1 开始下降到 0。危险率通常随时间变化。例如，抵押贷款违约的可能性在开始时可能很低，但随着抵押时间的推移可能会增加。</p>
<h2 id="什么是生存分析"><a href="#什么是生存分析" class="headerlink" title="什么是生存分析"></a>什么是生存分析</h2><p>生存分析，是研究生存现象和响应时间数据及其统计规律的一门学科。是将事件的结果（终点事件）和出现这一结果所经历的时间结合起来分析的一种统计分析方法。生存分析与其他多因素分析最大的区别，就是生存分析考虑了观测结果出现的时间长短</p>
<p>生存分析的发展可以追溯到17世纪，英国统计学家约翰·格兰特（John Graunt）于1662年制作了第一张生命表。生存分析可用于健康保险领域，以评估保险费。它可以成为客户保留的有用工具，例如，为了估计客户可能停止订阅的时间。有了这些信息，公司可以尽早进行一些激励措施，以留住客户。对即将到来的客户流失者的准确预测会产生高度针对性的营销活动，从而限制了花费在可能无论如何都会留下来的客户身上的资源。生存分析方法也可以应用于工程领域，例如估计机器的剩余使用寿命。</p>
<h2 id="为什么要用生存分析"><a href="#为什么要用生存分析" class="headerlink" title="为什么要用生存分析"></a>为什么要用生存分析</h2><p>当exposure和event之间的时间具有临床意义时，生存分析是重要的。因变量必须同时有2个，一个代表状态，必须是分类变量，一个代表时间，应该是连续变量</p>
<p><img src="https://i.328888.xyz/2023/01/23/OP4WV.png" alt="1"><br><img src="https://i.328888.xyz/2023/01/23/OPkqa.png" alt="2"><br><img src="https://i.328888.xyz/2023/01/23/OPC2x.png" alt="3"></p>
<h2 id="因果推断的反事实估计"><a href="#因果推断的反事实估计" class="headerlink" title="因果推断的反事实估计"></a>因果推断的反事实估计</h2><p><img src="https://i.328888.xyz/2023/01/24/OYLPc.png" alt="1"></p>
<p>相关性：去医院的人群健康水平比不去医院的人群健康水平更差<br>结论： 去医院对人健康不好 </p>
<p>吗?</p>
<p>当然不是，又例如</p>
<p>如果吃素的人突然开始吃肉，和那些没有改变生活习惯的被试（志愿者）相比，十年后的死亡率。<br>如果随机让一部分考入重点大学的学生去普通二本读书，毕业后的收入会有何变化？</p>
<p>本身健康状况不好的人更倾向于去医院，本身健康状况好的更倾向不去医院     -&gt;       选择偏差</p>
<p><img src="https://i.328888.xyz/2023/01/24/OYPWA.png" alt="1"></p>
<p>individual treatment effect 无法求得， D&#x3D;0是观测不到的结果，称为Countfactual outcomes</p>
<p>但实验中通常不关注individual treatment effect， 关注的是Average Treatment Effect（ATE）<br><img src="https://i.328888.xyz/2023/01/24/OYTmo.png" alt="1"></p>
<p><img src="https://i.328888.xyz/2023/01/24/OYavN.png" alt="2"></p>
<p><img src="https://i.328888.xyz/2023/01/24/OYQ4V.png" alt="3"></p>
<p><img src="https://i.328888.xyz/2023/01/24/OYYId.png" alt="4"></p>
<h1 id="相关工作"><a href="#相关工作" class="headerlink" title="相关工作"></a>相关工作</h1><p>1)Rao Y, Chen G, Lu J, et al. Counterfactual attention learning for fine-grained visual categorization and re-identification[C]&#x2F;&#x2F;Proceedings of the IEEE&#x2F;CVF International Conference on Computer Vision. 2021: 1025-1034.</p>
<p><img src="https://i.328888.xyz/2023/01/24/OYuqq.png" alt="1"></p>
<p>2)Tonekaboni S, Joshi S, Duvenaud D, et al. Explaining time series by counterfactuals[J]. 2019.</p>
<p>该论文提出了一种方法来自动计算时间序列中每个观测值的特征的重要性，通过模拟给先前观测值的反事实轨迹。我们将每个观测结果的重要性定义为用生成的观测结果替换观测结果所引起的模型输出的变化。我们的方法可以应用于任意复杂的时间序列模型。我们将生成的特征重要性与现有的方法如敏感度分析、特征遮挡和其他解释基线进行比较，以表明我们的方法产生更精确的解释，对输入信号中的噪声较不敏感<br><img src="https://i.328888.xyz/2023/01/24/Oqi2z.png" alt="1"></p>
<h1 id="背景：-纵向数据生存分析的研究意义"><a href="#背景：-纵向数据生存分析的研究意义" class="headerlink" title="背景： 纵向数据生存分析的研究意义"></a>背景： 纵向数据生存分析的研究意义</h1><p>与横断面数据（跨队列收集一次的数据）相比，高维纵向数据没有充分用于生存分析。特别是在心血管风险预测中，尽管有可用的纵向数据分析方法，纵向信息在提高预测准确性和临床适用性方面的价值尚未确立。许多方法把多个队列视为独立的样本(Extended Cox)，并未充分考虑队列间在时间上的依赖性。尽管大多数大型数据集包含在不同时间点对相同变量的重复测量（纵向数据），但只有一小部分预测模型包含纵向数据。这会从纵向数据集中丢弃有价值的信息。纵向数据用于长期风险预测的效用在文献中参差不齐。例如，在心血管疾病 (CVD) 风险预测中，一些研究报告称纵向数据改善了预测 [1-3]，而有些研究发现与仅使用基线数据相比，一些观察到的差异可以忽略不计甚至没有差异 [4-6]。然而，大多数研究只考虑少数（最多 8 个）随时间变化的协变量，并且主要关注传统的风险因素，如血压和总胆固醇。高维纵向数据在 CVD 风险预测中的效用仍然知之甚少，</p>
<p>下图显示了随着时间的推移，每种纵向建模策略的模型的性能。</p>
<p>使用纵向数据的模型通常比仅使用 Y15 数据或 Y0 数据的模型表现更好。在 Y0 数据上训练的模型表现最差，与 Y15 数据训练模型相比，AUC 低 0.03-0.05，与纵向数据训练模型相比，AUC 低 0.05-0.07。</p>
<p>使用至少两个时间点的纵向数据的模型和仅使用 Y15 数据的模型在预测窗口的早期具有相似的 CVD 预测性能，但随着更长期的随访，时变 AUC 的差距逐渐扩大到 0.03。尽管仅使用 Y15 数据的模型在 iAUC 中的结果仅比使用纵向数据的模型低 0.016，但仅使用 Y15 的模型在 10 年后的 iAUC、C 指数和 17 年随访时的 AUC 低约 0.03 .使用纵向数据的模型比横截面模型具有更高的 F1、PPV 和 MCC，由于这个年轻人群中的事件数量较少，所有模型的相对差异很小</p>
<p><img src="https://i.328888.xyz/2023/01/24/OYJ2t.png" alt="1"></p>
<p>已经提出了几种处理纵向数据的方法。最常见的方法之一是在预测模型中包含汇总统计数据，例如随时间变化的平均值、线性斜率或累积暴露（时间-暴露曲线下的区域）。然而，这些方法可能无法从纵向数据中完全捕获纵向数据集中包含的丰富信息，例如可变性和曝光时间。另一种流行的策略是联合建模 (JM)，它本质上是同时拟合和结合纵向和生存过程。</p>
<p>机器学习 (ML) 方法一直是高维数据的解决方案。许多工作已经证明了 ML 在医疗数据风险预测中的作用。然而，这些研究中的大多数采用基于 ML 分类的方法而不是生存分析，因此在处理事件发生时间结果时在几个方面受到限制。在为生存分析而设计的常用 ML 方法中，例如随机生存森林 (RSF) 、DeepSurv  和 Nnet-survival  ，许多方法不能直接将重复测量的时间序列作为输入进行处理。</p>
<p>最近引入了一些用于时间序列的生存分析算法，例如 Dynamic-DeepHit， RDSM 和 MATCH-Net， 但这些方法都是基于循环神经网络，在面对时间跨度较大或时间偏差较大时， 循环神经网络的预测能力会下降， 且循环神经网络不利于并行计算。</p>
<h2 id="一-隐含信息"><a href="#一-隐含信息" class="headerlink" title="一 隐含信息"></a>一 隐含信息</h2><p>医学随访的纵向数据存在两个特点：随访时变性，缺失率大。</p>
<p>前者出于患者自身的病情与预后恢复程度，每个样本的随访次数与间隔时间差异较大，因此这些间隔时间可能包含了患者的病情演化情况，个体恢复程度等信息，这在一定程度上与复发存在关系。</p>
<p>后者可分为客观性数据缺失和主观性数据缺失。客观性数据缺失通常是由于记录丢失、样本丢失、仪器失效等原因造成。在真实的医疗场景中，由于采样时间频率不一致或生理特征选择偏差导致的主观性数据缺失更为常见。专业医疗人员往往因各种客观原因还是会根据感兴趣事件来选择需要监测的患者生理特征，而不会监测其所有时间的所有数据；另外，医学纵向数据具有不同生理特征所需的监测频率不同的特点，都加剧了医疗时间序列数据的异常稀疏性。</p>
<h2 id="二-混淆信息"><a href="#二-混淆信息" class="headerlink" title="二 混淆信息"></a>二 混淆信息</h2><p>1）从纵向观察数据中估计治疗效果的现有方法假设没有隐藏的混杂因素， 将导致有偏的估计。（比如估计化疗对患者癌症进展的影响时不考虑对耐药性和毒性水平的依赖性）</p>
<p>2）纵向背景下隐藏混杂因素的估计明显比静态背景下更复杂，不仅因为隐藏混杂因素可能随时间变化，而且因为隐藏混杂因素可能受先前治疗和协变量的影响。因此，标准潜在变量模型不再适用，因为它们不能捕捉这些时间相关性。</p>
<p>3）时间序列分解依赖于建立一个随时间变化的因素模型，以获得潜在变量，这些潜在变量可以替代未观察到的混杂因素，用比标准方法更弱的假设获得个体化治疗反应的无偏估计。[17]使用条件生成器可以保证反事实不仅在域内进行采样，而且特别可能在个体样本X (n)下进行采样，而不是有一个跨总体数据的生成器。对历史的条件反射也允许我们学习信号的动态，因此根据过去的观察产生一个看似可信的反事实。[20]</p>
<p>针对以上两个问题，我们提出针对时变数据的反事实注意力机制和能够学习时变信息与缺失信息的生存分析Transformer模型。</p>
<ol>
<li><p>用Transformer 作为模型， 可以做到并行计算，提高计算效率， 并对长时间预测能力有所提高；使用随访的时间队列间隔作为Position Embedding， 弥补Transformer位置不敏感的缺陷，学习数据中时变队列所蕴含的隐含信息；同时利用缺失因子进一步对数据进行编码，使模型学习缺失值本身所包含的信息。</p>
</li>
<li><p>通过预训练的反事实生成器生成反事实样本，构造一个反事实注意力图，通过模拟个体治疗效应引导注意力机制消除数据偏差，减少数据混淆信息，最终提高模型预测能力。</p>
</li>
</ol>
<h1 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h1><h2 id="1-反事实样本的生成"><a href="#1-反事实样本的生成" class="headerlink" title="1.反事实样本的生成"></a>1.反事实样本的生成</h2><p>参考：<br><img src="https://i.328888.xyz/2023/01/24/OqVEw.png" alt="1"></p>
<p><img src="https://i.328888.xyz/2023/01/24/OqfPa.png" alt="2"></p>
<h2 id="2-反事实学习注意力"><a href="#2-反事实学习注意力" class="headerlink" title="2.  反事实学习注意力:"></a>2.  反事实学习注意力:</h2><p>利用反事实样本提供一个反事实的Query， 由此生成反事实注意力图，通过学习Y_effect  治疗效应来引导注意力模块消除混淆因素，提升生存分析模型预测性能。</p>
<h1 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h1><p>&#x2F;&#x2F;待写&#x2F;&#x2F;</p>
<h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p>[1] Kopper P, Wiegrebe S, Bischl B, et al. DeepPAMM: Deep Piecewise Exponential Additive Mixed Models for Complex Hazard Structures in Survival Analysis[J]. arXiv preprint arXiv:2202.07423, 2022.<br>[2] Kleinbaum D G, Klein M. Survival analysis: a self-learning text[M]. New York: Springer, 2012, p16.<br>[3] 辛晓丽,姜怡,沈丽萍,刘苓霜.中医药辅助治疗600例老年非小细胞肺癌患者的生存分析[J].中医杂志,2019,60(01):31-35+46.DOI:10.13288&#x2F;j.11-2166&#x2F;r.2019.01.<br>009.<br>[4] 徐重白,贾坚,吴中华.慢性心衰中医辨证分型及规范化治疗与预后的相关性[J].江西中医药,2011,42(09):9-11.<br>[5] Nagy Á, Munkácsy G, Győrffy B. Pancancer survival analysis of cancer hallmark genes[J]. Scientific reports, 2021, 11(1): 1-10.<br>[6] Győrffy B. Survival analysis across the entire transcriptome identifies biomarkers with the highest prognostic power in breast cancer[J]. Computational and structural biotechnology journal, 2021, 19: 4101-4109.<br>[7]Yang L, Yu M, Gao S. Prediction of coronary artery disease risk based on multiple longitudinal biomarkers. Stat Med. 2016;35(8):1299–314.<br>[8]Miller RG, Anderson SJ, Costacou T, Sekikawa A, Orchard TJ. Hemoglobin A1c level and cardiovascular disease incidence in persons with type 1 diabetes: an application of joint modeling of longitudinal and time-to-event data in the Pittsburgh Epidemiology of Diabetes Complications Study.Am J Epidemiol. 2018;187(7):1520–9.<br>[9]Allen NB, Siddique J, Wilkins JT, Shay C, Lewis CE, Goff DC, Jacobs DR, Liu K, Lloyd-Jones D. Blood pressure trajectories in early adulthood and subclinical atherosclerosis in middle age. JAMA. 2014;311(5):490–7.<br>[10]Sweeting MJ, Barrett JK, Thompson SG, Wood AM. The use of repeated blood pressure measures for cardiovascular risk prediction: a comparison of statistical models in the ARIC study. Stat Med. 2017;36(28):4514–28.<br>[11]Ayala Solares JR, Canoy D, Raimondi FED, Zhu Y, Hassaine A, Salimi-Khorshidi G, Tran J, Copland E, Zottoli M, Pinho‐Gomes AC. Long‐term exposure to elevated systolic blood pressure in predicting<br>[12]incident cardiovascular disease: evidence from large‐scale routine electronic health records. J Am Heart Association. 2019;8(12):e012129.<br>[13]Paige E, Barrett J, Pennells L, Sweeting M, Willeit P, Di Angelantonio E, Gudnason V, Nordestgaard BG, Psaty BM, Goldbourt U. Use of repeated blood pressure and cholesterol measurements to improve cardiovascular disease risk prediction: an individual-participant-data meta-analysis. Am J Epidemiol. 2017;186(8):899–907.<br>[14]Gok B, Jallo G, Hayeri R, Wahl R, Aygun N (2013) The evaluation<br>of FDG-PET imaging for epileptogenic focus localization in patients with MRI positive and MRI negative temporal lobe epilepsy.<br>Neuroradiology 55:541–550<br>[15]Bica I, Alaa A, Van Der Schaar M. Time series deconfounder: Estimating treatment effects over time in the presence of hidden confounders[C]&#x2F;&#x2F;International Conference on Machine Learning. PMLR, 2020: 884-895.<br>[20]Bica I, Alaa A, Van Der Schaar M. Time series deconfounder: Estimating treatment effects over time in the presence of hidden confounders[C]&#x2F;&#x2F;International Conference on Machine Learning. PMLR, 2020: 884-895.</p>

        </div>

    

</div>
                <div class="footer">
    <span>Copyright © 2022 Booo</span>
    <span>Theme Designed By <a target="_blank" href="https://zheli.design/one-paper">這李設計</a></span>
</div>


<link rel="stylesheet" href="/css/a11y-dark.min.css">


<script src="/js/highlight.min.js"></script>


<script src="/js/highlightjs-line-numbers.js"></script>


<script>
    hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
</script>

            </div>
        </div>
    </body>
</html>